# {본인 서비스 이름} - 프로젝트 구조 및 역할 설명서

## 📋 프로젝트 개요

{본인 서비스 이름}는 MSA(Microservice Architecture) 환경에서 동작하는 **단일 마이크로서비스**입니다. 

**⚠️ 중요**: 이 서비스는 여러 마이크로서비스 중 하나로, MySQL, Redis, Kafka 등의 인프라는 **외부에서 공유 서비스로 관리**됩니다. 컨테이너 오케스트레이션 플랫폼(Kubernetes, Docker Swarm 등)에서 배포되어 운영됩니다.

**주요 특징:**
- Auth0 기반 JWT 인증으로 Stateless 보안
- Kafka를 통한 이벤트 기반 서비스 간 통신  
- Redis 캐싱을 통한 성능 최적화
- Prometheus 메트릭 기반 모니터링
- Container-First 설계

## 📁 프로젝트 디렉터리 구조

```
{본인 서비스 이름}/
├── 📁 src/
│   ├── 📁 main/
│   │   ├── 📁 java/org/example/{본인 서비스 이름}/
│   │   │   ├── 📄 {본인 서비스 이름}Application.java        # Spring Boot 메인 애플리케이션
│   │   │   ├── 📁 aspect/                             # AOP 관련 클래스
│   │   │   ├── 📁 config/                             # 설정 클래스들
│   │   │   ├── 📁 controller/                         # REST API 컨트롤러
│   │   │   ├── 📁 domain/                             # JPA 엔티티 및 도메인 모델
│   │   │   ├── 📁 dto/                                # 데이터 전송 객체
│   │   │   ├── 📁 event/                              # 이벤트 관련 클래스
│   │   │   ├── 📁 security/                           # 보안 관련 클래스
│   │   │   └── 📁 util/                               # 유틸리티 클래스
│   │   └── 📁 resources/                              # 설정 파일 및 리소스
│   └── 📁 test/                                       # 테스트 코드
├── 📄 build.gradle                                   # Gradle 빌드 스크립트
├── 📄 Dockerfile                                     # Docker 이미지 빌드 설정
├── 📄 docker-compose.yml                            # 로컬 개발 환경 구성
└── 📁 monitoring/                                    # 모니터링 설정
```

---

## 📂 주요 디렉터리별 상세 설명

### 🔧 `/src/main/java/org/example/{본인 서비스 이름}/`

#### **📄 {본인 서비스 이름}Application.java**
- **역할**: Spring Boot 애플리케이션의 메인 진입점
- **기능**: 
  - Spring Boot 자동 구성 활성화
  - 애플리케이션 시작 시 필요한 빈들을 스캔하고 초기화
  - 서블릿 컨테이너 내장 및 HTTP 서버 구동

---

### 🎯 `/aspect/` - AOP(Aspect-Oriented Programming)

#### **📄 LoggingAspect.java**
- **역할**: AOP를 사용한 로깅 및 성능 모니터링
- **기능**:
  - 메소드 실행 시간 측정 및 로깅
  - 예외 발생 시 오류 로깅
  - 컨트롤러와 서비스 레이어 구분 로깅
  - 메소드 입출력 매개변수 및 반환값 로깅 (디버그 모드)

---

### ⚙️ `/config/` - 설정 클래스들

#### **📄 AsyncConfig.java**
- **역할**: 비동기 작업 처리 설정
- **기능**:
  - @Async 애노테이션 활성화
  - 비동기 작업용 ThreadPool 구성
  - MSA 환경 성능 최적화를 위한 쓰레드 설정

#### **📄 JpaConfig.java**
- **역할**: JPA(Java Persistence API) 설정
- **기능**:
  - JPA Repository 스캔 및 활성화
  - JPA Auditing 활성화 (생성일자, 수정일자 자동 설정)
  - 엔티티 매니저 및 트랜잭션 관리 설정

#### **📄 KafkaConfig.java**
- **역할**: Apache Kafka 메시징 시스템 설정
- **기능**:
  - Kafka Producer 설정 (메시지 전송용)
  - Kafka Consumer 설정 (메시지 수신용)
  - JSON 직렬화/역직렬화 설정
  - Kafka Listener Container Factory 설정

#### **📄 OpenApiConfig.java**
- **역할**: OpenAPI 3.0 (Swagger) 문서화 설정
- **기능**:
  - API 문서 메타데이터 설정 (제목, 버전, 설명, 연락처 등)
  - 다중 환경 서버 설정 (로컬, 개발, 운영)
  - JWT Bearer 토큰 인증 스키마 설정
  - OpenAPI 스펙 기반 자동 문서 생성

#### **📄 RedisConfig.java**
- **역할**: Redis 캐시 및 세션 저장소 설정
- **기능**:
  - Redis 연결 팩토리 및 커넥션 풀 설정
  - RedisTemplate 구성 (JSON 직렬화/역직렬화)
  - Spring Cache 추상화를 위한 캐시 매니저 설정
  - TTL 및 캐시 정책 관리

#### **📄 SecurityConfig.java**
- **역할**: Spring Security 및 Auth0 JWT 토큰 인증 설정
- **기능**:
  - Stateless JWT 기반 인증 (세션 사용 안함)
  - Auth0 JWT 토큰 검증 및 Audience 확인
  - 메소드 레벨 보안 (@PreAuthorize, @PostAuthorize)
  - 공개 엔드포인트 설정 (health check, swagger 등)

---

### 🌐 `/controller/` - REST API 컨트롤러

#### **📄 HealthController.java**
- **역할**: 서비스 상태 확인용 Health Check 컨트롤러
- **기능**:
  - 서비스 상태 확인 (UP/DOWN)
  - 애플리케이션 버전 정보 제공
  - 시스템 정보 제공 (JVM 버전, 시간 등)
  - Kubernetes 사이드카 서비스나 로드밸런서에서 사용

---

### 💾 `/domain/` - 도메인 모델 및 JPA 엔티티

#### **📄 BaseEntity.java**
- **역할**: 모든 엔티티의 기본 승계 클래스
- **기능**:
  - 공통 기본 필드 제공 (ID, 생성일자, 수정일자, 삭제 여부)
  - JPA Auditing을 통한 생성/수정 일시 자동 관리
  - Soft Delete 패턴 지원 (삭제 플래그 관리)
  - 엔티티 기본 라이프사이클 관리

#### **📁 Entity/**
- **역할**: 구체적인 JPA 엔티티 클래스들을 위한 디렉터리 (현재 비어있음)

#### **📁 enums/**
- **역할**: 도메인 관련 열거형(Enum) 클래스들을 위한 디렉터리 (현재 비어있음)

---

### 📦 `/dto/` - 데이터 전송 객체

#### **📁 common/**

##### **📄 BaseResponse.java**
- **역할**: API 응답의 공통 반환 형식을 정의하는 제네릭 클래스
- **기능**:
  - 성공/실패 상태 플래그 제공
  - 일반적인 메시지 및 데이터 필드
  - 응답 시간 타임스탬프 자동 기록
  - 정적 팩토리 메소드를 통한 간편한 응답 생성

#### **📁 request/** & **📁 response/**
- **역할**: 요청/응답 전용 DTO 클래스들을 위한 디렉터리 (현재 비어있음)

---

### 📧 `/event/` - 이벤트 기반 아키텍처

#### **📁 model/**

##### **📄 BaseEvent.java**
- **역할**: 모든 이벤트의 기본 클래스
- **기능**:
  - 이벤트 기본 메타데이터 관리 (이벤트 ID, 타입, 타임스탬프 등)
  - 마이크로서비스 추적을 위한 상관 ID 및 소스 서비스 정보 제공
  - 자동 이벤트 ID 생성 및 타임스탬프 기록

#### **📁 publisher/**

##### **📄 EventPublisher.java**
- **역할**: 마이크로서비스 이벤트 발행 컴포넌트
- **기능**:
  - Kafka를 통한 이벤트 메시지 발행
  - 이벤트 발행 상태 로깅 및 모니터링
  - 비동기 방식으로 이벤트 발행 및 성공/실패 대응
  - Domain Event Pattern 구현을 위한 공통 인터페이스

#### **📁 listener/**
- **역할**: 이벤트 리스너 클래스들을 위한 디렉터리 (현재 비어있음)

---

### 🔐 `/security/` - 보안 관련 클래스

#### **📄 AudienceValidator.java**
- **역할**: Auth0 JWT 토큰의 Audience 클레임 검증자
- **기능**:
  - JWT 토큰의 'aud'(어디언스) 클레임 검증
  - 토큰 오남용 및 보안 공격 방지
  - Auth0에서 설정한 API Identifier와 일치 여부 확인
  - Spring Security OAuth2 Token Validator 인터페이스 구현

---

### 🛠️ `/util/` - 유틸리티 클래스

#### **📄 JwtUtils.java**
- **역할**: JWT 토큰에서 사용자 정보 및 권한을 추출하는 유틸리티
- **기능**:
  - JWT 토큰에서 사용자 ID, 이메일, 이름 등 클레임 추출
  - 사용자 권한(Permission) 확인 및 검증
  - 다중 권한 확인 지원
  - 안전한 Optional 기반 값 반환

---

## 🧪 `/src/test/` - 테스트 코드

### **📄 CustomApiSvcApplicationTests.java**
- **역할**: Spring Boot 애플리케이션 기본 테스트 클래스
- **기능**: 애플리케이션 컨텍스트 로딩 및 기본 기능 테스트

### **📁 controller/**

#### **📄 BaseControllerTest.java**
- **역할**: 컨트롤러 레이어 테스트를 위한 기본 추상 클래스
- **기능**:
  - MockMvc를 통한 HTTP 요청/응답 테스트
  - JSON 직렬화/역직렬화 지원
  - 컨트롤러 레이어 단위 테스트 환경

### **📁 integration/**

#### **📄 BaseIntegrationTest.java**
- **역할**: 통합 테스트를 위한 기본 추상 클래스
- **기능**:
  - TestContainers를 사용한 실제 DB, Redis, Kafka 환경 구성
  - 전체 Spring Boot 애플리케이션 컨텍스트 로딩
  - 랜덤 포트로 웹 서버 구동 및 HTTP API 테스트
  - 트랜잭션 롤백 지원으로 테스트 간 데이터 격리

### **📁 repository/**

#### **📄 BaseRepositoryTest.java**
- **역할**: JPA Repository 레이어 테스트를 위한 기본 추상 클래스
- **기능**:
  - @DataJpaTest를 통한 JPA 레이어만 로딩 (빠른 테스트)
  - 내장형 H2 데이터베이스 사용
  - TestEntityManager를 통한 엔티티 직접 조작 및 검증

### **📁 testcontainers/**

#### **📄 TestContainerConfig.java**
- **역할**: 통합 테스트를 위한 TestContainers 설정 클래스
- **기능**:
  - MySQL 데이터베이스 컨테이너 설정
  - Redis 캐시 컨테이너 설정
  - Kafka 메시지 브로커 컨테이너 설정
  - 실제 외부 의존성과 동일한 환경에서의 테스트

### **📁 unit/**

#### **📄 BaseUnitTest.java**
- **역할**: 단위 테스트를 위한 기본 추상 클래스
- **기능**:
  - Mockito Extension을 통한 목 객체 자동 생성 및 주입
  - Spring Context 로딩 없이 가장 빠른 테스트 수행
  - 비즈니스 로직 단위 테스트에 적합

---

## 📋 설정 파일들

### **📄 `/src/main/resources/application.yml`**
- **역할**: 애플리케이션 주요 설정 파일
- **포함 내용**:
  - 데이터베이스 연결 설정 (MySQL, H2)
  - Redis 캐시 설정
  - Kafka 메시징 설정
  - Auth0 인증 설정
  - JPA/Hibernate 설정
  - 로깅 설정
  - 모니터링 설정 (Actuator, Prometheus)
  - 환경별 프로파일 설정 (dev, prod)

### **📄 `/src/main/resources/application.properties`**
- **역할**: 기본 애플리케이션 설정
- **내용**: 애플리케이션 이름 설정

### **📄 `/src/test/resources/application-test.yml`**
- **역할**: 테스트 환경 전용 설정 파일
- **기능**: 테스트용 데이터베이스, 로깅 설정 등

---

## 🐳 Docker 및 인프라 설정

### **📄 Dockerfile**
- **역할**: Docker 이미지 빌드 설정
- **기능**: 애플리케이션 컨테이너화를 위한 이미지 생성

### **📄 docker-compose.yml**
- **역할**: 로컬 개발 환경 구성
- **기능**: MySQL, Redis, Kafka 등 외부 의존성 컨테이너 구성

### **📁 monitoring/**

#### **📄 prometheus.yml**
- **역할**: Prometheus 모니터링 설정
- **기능**: 메트릭 수집 및 모니터링 구성

---

## 📦 빌드 설정

### **📄 build.gradle**
- **역할**: Gradle 빌드 스크립트
- **포함 의존성**:
  - Spring Boot Starters (Web, JPA, Security, Actuator)
  - OAuth2 Resource Server (Auth0 JWT 인증)
  - Spring Cloud (Circuit Breaker, OpenFeign)
  - Apache Kafka
  - Redis
  - TestContainers
  - Swagger/OpenAPI 문서화
  - Prometheus 모니터링

---

## 🔍 주요 기술 스택

- **Framework**: Spring Boot 3.5.4
- **Java Version**: Amazon Corretto 17
- **Database**: MySQL 8.0, H2 (테스트용)
- **Cache**: Redis 7
- **Messaging**: Apache Kafka
- **Authentication**: Auth0 JWT
- **Documentation**: Swagger/OpenAPI 3.0
- **Monitoring**: Prometheus + Actuator
- **Testing**: JUnit 5, Mockito, TestContainers
- **Build Tool**: Gradle

---

## 🚀 애플리케이션 실행 방법

1. **로컬 개발 환경 시작**:
   ```bash
   docker-compose up -d
   ```

2. **애플리케이션 실행**:
   ```bash
   ./gradlew bootRun
   ```

3. **테스트 실행**:
   ```bash
   ./gradlew test
   ```

4. **Swagger UI 접속**:
   - URL: `http://localhost:8080/api/v1/swagger-ui.html`

5. **Health Check**:
   - URL: `http://localhost:8080/api/v1/health`

---

## 📊 모니터링 엔드포인트

- **Health Check**: `/api/v1/health`
- **Metrics**: `/actuator/prometheus`
- **Application Info**: `/actuator/info`

---

## 📝 개발 가이드라인

1. **패키지 구조**: 레이어별로 명확히 분리된 패키지 구조 유지
2. **테스트**: 단위 테스트, 통합 테스트, 컨트롤러 테스트 각각의 Base 클래스 활용
3. **보안**: Auth0 JWT 토큰 기반 인증 사용
4. **로깅**: AOP를 통한 자동 로깅 및 성능 모니터링
5. **이벤트**: Kafka 기반 이벤트 드리븐 아키텍처 적용
6. **캐시**: Redis를 활용한 성능 최적화
7. **문서화**: Swagger를 통한 API 문서 자동 생성

---

*이 문서는 Custom API Service 프로젝트의 구조와 각 구성 요소의 역할을 설명합니다. 프로젝트 개발 및 유지보수 시 참고하시기 바랍니다.*